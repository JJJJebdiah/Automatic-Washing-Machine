C51 COMPILER V9.60.7.0   IRED                                                              06/26/2023 12:59:45 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE IRED
OBJECT MODULE PLACED IN .\Objects\ired.obj
COMPILER INVOKED BY: E:\Keil_v5\C51\BIN\C51.EXE ired.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\ired
                    -.lst) OBJECT(.\Objects\ired.obj)

line level    source

   1          #include "ired.h"
   2          #include "lcd1602.h"
   3          
   4          sbit IRED=P3^2;//æ¥æ”¶ç«¯å£
   5          
   6          u8 cmd_flag=0,addr_flag=0;//æ•°æ®æ¥æ”¶æ ‡å¿—ä½,0:æœªæ¥æ”¶ï¼Œ1:æ¥æ”¶å®Œæˆ
   7          u8 ired_data[4];//å­˜å‚¨æ¥æ”¶åˆ°çš„æ•°æ®(åœ°å€ç ã€åœ°å€åç ã€æ•°æ®ç ã€æ•°æ®åç )ï¼Œä¸ºåå…
             -­è¿›åˆ¶
   8          
   9          void ired_init(void)
  10          {
  11   1          /*
  12   1              åˆå§‹åŒ–çº¢å¤–æ¥æ”¶å™¨ï¼Œä½¿ç”¨å¤–éƒ¨ä¸­æ–­0
  13   1          */
  14   1              IT0=1;  //ä¸‹é™æ²¿è§¦å‘
  15   1              EX0=1;  //æ‰“å¼€ä¸­æ–­0
  16   1              EA=1;   //æ‰“å¼€æ€»ä¸­æ–­
  17   1              IRED=1;
  18   1          PX0=1;//é«˜ä¼˜å…ˆçº§
  19   1      }
  20          
  21          
  22          u8 ired_get_cmd()
  23          {
  24   1          /*è·å¾—æ§åˆ¶ç */
  25   1          if(cmd_flag==1)
  26   1          {
  27   2              cmd_flag=0;
  28   2              return ired_data[2];
  29   2          }
  30   1          else
  31   1              return 0;
  32   1      }
  33          
  34          u8 ired_get_addr()
  35          {
  36   1          /*è·å¾—åœ°å€ç */
  37   1          if(addr_flag==1)
  38   1          {
  39   2              addr_flag=0;
  40   2              return ired_data[0];
  41   2          }
  42   1          else
  43   1              return 0;
  44   1      }
  45          
  46          
  47          void ired_int() interrupt 0
  48          {
  49   1          /*è§£ç */
  50   1          u16 t=0,high_time=0;
  51   1          u8 i,j;
  52   1          if(IRED==0)
  53   1          {
C51 COMPILER V9.60.7.0   IRED                                                              06/26/2023 12:59:45 PAGE 2   

  54   2              t=1000;
  55   2              while(IRED==0&&t>0)//ç­‰å¾…å¼•å¯¼ä¿¡å·9msä½ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡10msåˆ™è®¤ä¸ºæ˜¯å¹²æ‰°ä¿¡å·
  56   2              {
  57   3                  delay_10us();
  58   3                  t--;
  59   3                  if(t==0)
  60   3                  {
  61   4                      addr_flag=0;
  62   4                      cmd_flag=0;
  63   4                      return;
  64   4                  }
  65   3              }
  66   2      
  67   2              t=500;
  68   2              while(IRED==1&&t>0)//ç­‰å¾…å¼•å¯¼ä¿¡å·4.5msé«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡5msåˆ™è®¤ä¸ºæ˜¯å¹²æ‰°ä¿¡å·
  69   2              {
  70   3                  delay_10us();
  71   3                  t--;
  72   3                  if(t==0)
  73   3                  {
  74   4                      addr_flag=0;
  75   4                      cmd_flag=0;
  76   4                      return;
  77   4                  }
  78   3              }
  79   2              for(i=0;i<4;i++)//è¯»å–4ä¸ªå­—èŠ‚æ•°æ®
  80   2              {
  81   3                  for(j=0;j<8;j++)//è¯»å–8ä½æ•°æ®
  82   3                  {
  83   4                      t=600;
  84   4                      while(IRED==0&&t>0)//ç­‰å¾…æ•°æ®0/1å‰çš„0.56msä½ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡1msåˆ™è®¤ä¸ºæ˜¯
             -å¹²æ‰°ä¿¡å·
  85   4                      {
  86   5                          delay_10us();
  87   5                          t--;
  88   5                          if(t==0)
  89   5                          {
  90   6                              addr_flag=0;
  91   6                              cmd_flag=0;
  92   6                              return;
  93   6                          }
  94   5                      }
  95   4                      while(IRED==1)//è®¡ç®—é«˜ç”µå¹³æ—¶é—´
  96   4                      {
  97   5                          delay_100us_11M(1);
  98   5                          high_time++;
  99   5                          if(high_time>20)//è‹¥è¶…è¿‡2msåˆ™è®¤ä¸ºæ˜¯å¹²æ‰°ä¿¡å·
 100   5                          {
 101   6                              addr_flag=0;
 102   6                              cmd_flag=0;
 103   6                              return;
 104   6                          }
 105   5                      }
 106   4                      ired_data[i]>>=1;//å³ç§»ä¸€ä½
 107   4                      if(high_time>=8)//è‹¥é«˜ç”µå¹³æ—¶é—´å¤§äº0.8msï¼Œåˆ™è®¤ä¸ºæ˜¯æ•°æ®1
 108   4                          ired_data[i]|=0x80;
 109   4                      else ired_data[i]&=0x7f;//å¦åˆ™æ˜¯æ•°æ®0
 110   4                      high_time=0;
 111   4                  }
 112   3              }
 113   2              lcd1602_write_hex(0,0,0xac,2);
 114   2              //æ£€éªŒæ•°æ®æ˜¯å¦æ­£ç¡®
C51 COMPILER V9.60.7.0   IRED                                                              06/26/2023 12:59:45 PAGE 3   

 115   2              if(ired_data[0]!=~ired_data[1] || ired_data[2]!=~ired_data[3])
 116   2              {
 117   3                  //æ•°æ®é”™è¯¯
 118   3                  for(i=0;i<4;i++)
 119   3                      ired_data[i]=0;
 120   3                  addr_flag=0;
 121   3                  cmd_flag=0;
 122   3                  return;
 123   3              }
 124   2              addr_flag=1;
 125   2              cmd_flag=1;//æ•°æ®æ¥æ”¶å®Œæˆ
 126   2      
 127   2          }
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    399    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
